<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calculatrice Transport Colivex</title>

<style>
:root{
  --red:#D71920;      /* Rouge logo Colivex */
  --blue:#1E4FA3;     /* Bleu logo Colivex */
  --bg:#f4f6fb;
  --card:#ffffff;
  --border:#e5e7eb;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:var(--bg);
}

.container{max-width:760px;margin:auto;padding:14px;}

.header{
  background:linear-gradient(135deg,var(--blue),var(--red));
  color:#fff;border-radius:16px;padding:18px;text-align:center;
}

.header img{
  max-width:190px;margin-bottom:10px;background:#fff;
  padding:8px;border-radius:12px;
}

.card{
  background:#fff;border:1px solid var(--border);
  border-radius:14px;padding:14px;margin-top:14px;
}

label{font-weight:800;font-size:14px;}

input,select,button{
  width:100%;padding:12px;margin-top:6px;
  border-radius:12px;border:1px solid var(--border);
  font-size:16px;
}

button.primary{
  background:linear-gradient(135deg,var(--blue),var(--red));
  color:#fff;font-weight:900;border:none;cursor:pointer;
}

button.secondary{
  background:#fff;font-weight:800;cursor:pointer;
}

.row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
@media(max-width:600px){.row{grid-template-columns:1fr}}

.small{color:#6b7280;font-size:13px;margin-top:6px;}

.pill{
  display:inline-block;
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:999px;
  font-weight:900;
  background:#fafafa;
}

.extraItem{
  display:flex;justify-content:space-between;align-items:center;
  border:1px solid var(--border);padding:10px;border-radius:12px;margin-top:8px;
  gap:10px;
}

.remove{
  background:#fff;border:1px solid var(--border);
  border-radius:10px;width:38px;height:38px;font-size:18px;cursor:pointer;
}

.totalBox{
  background:#eef3ff;border:2px solid var(--blue);
  border-radius:14px;padding:14px;
}
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <img src="./logo-colivex.png" alt="Transport Colivex">
    <h2>Calculatrice de facture</h2>
    <div class="small" style="color:#fff;opacity:.95">
      Heures auto • + Transport • TPS/TVQ • Dépôt • Extras
    </div>
  </div>

  <!-- HEURES AUTO -->
  <div class="card">
    <div class="row">
      <div>
        <label>Heure d’arrivée</label>
        <input id="startTime" type="time">
      </div>
      <div>
        <label>Heure de départ</label>
        <input id="endTime" type="time">
      </div>

      <div>
        <label>Heures travaillées (auto)</label>
        <input id="hours" type="number" step="0.01" readonly>
        <div class="small">Calculé automatiquement avec arrivée + départ (gère minuit)</div>
      </div>

      <div>
        <label>Tarif horaire ($)</label>
        <input id="rate" type="number" value="145" step="0.01">
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div>
        <label>Frais transport (heures)</label>
        <input id="transportHours" type="number" value="1" step="0.25" min="0">
        <div class="small">Par défaut : 1h (modifie si besoin)</div>
      </div>

      <div>
        <label>Dépôt reçu (taxes incluses)</label>
        <input id="deposit" type="number" value="250" step="0.01" min="0">
      </div>
    </div>

    <div class="small" id="hoursPreview"></div>
  </div>

  <!-- EXTRAS -->
  <div class="card">
    <label>Extras – Matériel d’emballage</label>

    <select id="extraSelect">
      <option value="2.5">Ruban adhésif 2" (TAPE) — 2,50 $</option>
      <option value="6">Housse à matelas 39" (simple) — 6,00 $</option>
      <option value="8">Housse à matelas 60" (queen) — 8,00 $</option>
      <option value="11">Housse à matelas 70" (king) — 11,00 $</option>
      <option value="2.25">Boîte 1,5 pieds cubes — 2,25 $</option>
      <option value="2.75">Boîte 2 pieds cubes — 2,75 $</option>
      <option value="4.5">Boîte 4 pieds cubes — 4,50 $</option>
      <option value="5.5">Boîte 5 pieds cubes — 5,50 $</option>
      <option value="7">Boîte à vaisselle — 7,00 $</option>
      <option value="7.5">Boîte abat-jour — 7,50 $</option>
      <option value="18.5">Boîte garde-robes (inclut la barre) — 18,50 $</option>
      <option value="0">Garde-robes NO CHARGE — 0,00 $</option>
      <option value="7.5">Boîte miroir/cadre (Inner) — 7,50 $</option>
      <option value="8.5">Boîte miroir/cadre (Outer) — 8,50 $</option>
      <option value="8.5">Rouleau papier bulles 1/2" x 48" x 5' — 8,50 $</option>
      <option value="8.5">Rouleau papier bulles 3/16" x 48" x 10' — 8,50 $</option>
      <option value="15">Papier d'emballage 10 livres — 15,00 $</option>
      <option value="27.5">Papier d'emballage 25 livres — 27,50 $</option>
      <option value="25">Couverture matelassée — 25,00 $</option>
      <option value="15">Couverture matelassée (usagée) — 15,00 $</option>
      <option value="18.5">Garde-Robes usagée — 18,50 $</option>
    </select>

    <div class="row" style="margin-top:12px;">
      <div>
        <label>Quantité</label>
        <input id="qty" type="number" value="1" min="1" step="1">
      </div>
      <div>
        <label>&nbsp;</label>
        <button class="primary" type="button" id="addExtraBtn">Ajouter extra</button>
      </div>
    </div>

    <button class="secondary" style="margin-top:10px" type="button" id="clearExtrasBtn">Vider extras</button>

    <div id="extras"></div>
  </div>

  <!-- CALCUL -->
  <div class="card">
    <button class="primary" type="button" id="calcBtn">Calculer total</button>
  </div>

  <div class="card totalBox" id="resultBox" style="display:none">
    <p>Sous-total : <strong id="sub"></strong></p>
    <p>TPS (5 %) : <strong id="tps"></strong></p>
    <p>TVQ (9,975 %) : <strong id="tvq"></strong></p>
    <p>Dépôt : <strong id="dep"></strong></p>
    <h3>Total à payer : <span id="total"></span></h3>
  </div>

</div>

<script>
const TPS = 0.05;
const TVQ = 0.09975;

const extras = [];

function money(v){
  return (Number(v)||0).toLocaleString("fr-CA",{style:"currency",currency:"CAD"});
}

// Parse "HH:MM" => minutes
function timeToMinutes(t){
  if(!t || typeof t !== "string" || !t.includes(":")) return null;
  const [h,m] = t.split(":").map(n => parseInt(n,10));
  if(Number.isNaN(h) || Number.isNaN(m)) return null;
  return h*60 + m;
}

// calc hours; if end < start => next day
function calcWorkHours(startStr, endStr){
  const s = timeToMinutes(startStr);
  const e = timeToMinutes(endStr);
  if(s === null || e === null) return null;

  let diff = e - s;
  if(diff < 0) diff += 24*60; // passe minuit
  return diff / 60; // heures
}

function updateHoursAuto(){
  const start = document.getElementById("startTime").value;
  const end = document.getElementById("endTime").value;

  const hours = calcWorkHours(start, end);
  const hoursInput = document.getElementById("hours");
  const preview = document.getElementById("hoursPreview");

  if(hours === null){
    hoursInput.value = "";
    preview.textContent = "Entre une heure d’arrivée + départ pour calcul automatique.";
    return;
  }

  // arrondi à 0.01h (tu peux changer si tu veux)
  const rounded = Math.round(hours * 100) / 100;
  hoursInput.value = rounded;

  preview.innerHTML = `Heures travaillées calculées : <span class="pill">${rounded} h</span>`;
}

function renderExtras(){
  const div = document.getElementById("extras");
  div.innerHTML = "";

  if(extras.length === 0){
    div.innerHTML = '<div class="small">Aucun extra ajouté</div>';
    return;
  }

  extras.forEach((e,i)=>{
    div.innerHTML += `
      <div class="extraItem">
        <div>${e.qty} × ${e.name}</div>
        <button class="remove" type="button" onclick="removeExtra(${i})">✕</button>
      </div>`;
  });
}

function addExtra(){
  const sel = document.getElementById("extraSelect");
  const price = parseFloat(sel.value);
  const name = sel.options[sel.selectedIndex].text;
  const qty = parseInt(document.getElementById("qty").value, 10);

  if(!qty || qty <= 0){ alert("Quantité invalide"); return; }
  if(Number.isNaN(price)){ alert("Prix invalide"); return; }

  extras.push({name, price, qty});
  renderExtras();
}

function removeExtra(i){
  extras.splice(i,1);
  renderExtras();
}

function clearExtras(){
  extras.length = 0;
  renderExtras();
}

function calculate(){
  updateHoursAuto(); // s'assure que les heures sont à jour

  const rate = +document.getElementById("rate").value || 0;
  const hours = +document.getElementById("hours").value || 0;
  const transportHours = +document.getElementById("transportHours").value || 0;
  const deposit = +document.getElementById("deposit").value || 0;

  let subtotal = (rate * hours) + (rate * transportHours);

  extras.forEach(e => {
    subtotal += (e.price * e.qty);
  });

  const tps = subtotal * TPS;
  const tvq = subtotal * TVQ;
  const total = subtotal + tps + tvq - deposit;

  document.getElementById("sub").innerText = money(subtotal);
  document.getElementById("tps").innerText = money(tps);
  document.getElementById("tvq").innerText = money(tvq);
  document.getElementById("dep").innerText = "-" + money(deposit);
  document.getElementById("total").innerText = money(total);
  document.getElementById("resultBox").style.display = "block";
}

// Events
document.getElementById("startTime").addEventListener("input", updateHoursAuto);
document.getElementById("endTime").addEventListener("input", updateHoursAuto);
document.getElementById("addExtraBtn").addEventListener("click", addExtra);
document.getElementById("clearExtrasBtn").addEventListener("click", clearExtras);
document.getElementById("calcBtn").addEventListener("click", calculate);

// Init
renderExtras();
updateHoursAuto();
</script>
</body>
</html>