<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculatrice Colivex</title>
<style>
  body{font-family:Arial;background:#eef2f7;margin:0;padding:16px}
  .container{max-width:480px;margin:auto;background:#fff;padding:16px;border-radius:14px;border-top:6px solid #c1121f}
  h1{text-align:center;color:#1f4e79;margin:0}
  h1 span{color:#c1121f}
  label{font-weight:700;margin-top:12px;display:block}
  input,select,button{width:100%;padding:12px;margin-top:6px;font-size:16px;border-radius:10px;border:1px solid #ccc}
  button{background:#c1121f;color:#fff;font-weight:800;border:none;margin-top:18px}
  .result{margin-top:18px;background:#f7f9fc;padding:14px;border-radius:12px;border-left:6px solid #1f4e79}
  .line{display:flex;justify-content:space-between;margin:8px 0}
  .total{font-weight:900;font-size:18px}
</style>
</head>

<body>
<div class="container">
  <h1>Transport <span>Colivex</span></h1>

  <label>Tarif horaire ($)</label>
  <input id="taux" type="number" value="155" />

  <label>Heure d’arrivée</label>
  <input id="arrivee" type="time" />

  <label>Heure de départ</label>
  <input id="depart" type="time" />

  <label>Frais transport (heures)</label>
  <select id="transport">
    <option value="0">0 h</option>
    <option value="0.5">0.5 h</option>
    <option value="1" selected>1 h</option>
    <option value="1.5">1.5 h</option>
    <option value="2">2 h</option>
  </select>

  <label>Dépôt (taxes incluses)</label>
  <select id="depot">
    <option value="0">Aucun dépôt</option>
    <option value="250">250 $</option>
    <option value="500">500 $</option>
  </select>

  <button id="btnCalc" type="button">Calculer</button>

  <div class="result" id="resultat" style="display:none">
    <div class="line"><span>Heures travaillées</span><strong id="hTravail">0.00 h</strong></div>
    <div class="line"><span>Heures facturables</span><strong id="hFact">0.00 h</strong></div>

    <hr />

    <div class="line"><span>Sous-total</span><strong id="sub">0.00 $</strong></div>
    <div class="line"><span>TPS (5%)</span><strong id="tps">0.00 $</strong></div>
    <div class="line"><span>TVQ (9.975%)</span><strong id="tvq">0.00 $</strong></div>
    <div class="line total"><span>Total taxes incluses</span><strong id="total">0.00 $</strong></div>
    <div class="line"><span>Dépôt reçu</span><strong id="depotTxt">-0.00 $</strong></div>
    <div class="line total"><span>Grand total à payer</span><strong id="grand">0.00 $</strong></div>
  </div>
</div>

<script>
  const TPS = 0.05;
  const TVQ = 0.09975;
  const MIN_TRAVAIL = 3; // minimum de travail (bloqué)

  const elTaux = document.getElementById("taux");
  const elArrivee = document.getElementById("arrivee");
  const elDepart = document.getElementById("depart");
  const elTransport = document.getElementById("transport");
  const elDepot = document.getElementById("depot");
  const elResultat = document.getElementById("resultat");

  const outHTravail = document.getElementById("hTravail");
  const outHFact = document.getElementById("hFact");
  const outSub = document.getElementById("sub");
  const outTps = document.getElementById("tps");
  const outTvq = document.getElementById("tvq");
  const outTotal = document.getElementById("total");
  const outDepot = document.getElementById("depotTxt");
  const outGrand = document.getElementById("grand");

  function timeToHours(t){
    if(!t) return null;
    const [hh, mm] = t.split(":").map(Number);
    return hh + (mm / 60);
  }

  function calculer(){
    const taux = parseFloat(elTaux.value || "0");
    const a = timeToHours(elArrivee.value);
    const d = timeToHours(elDepart.value);

    // si pas d'heures sélectionnées, on stop
    if (a === null || d === null){
      alert("Choisis l'heure d'arrivée ET l'heure de départ.");
      return;
    }

    // heures travaillées (gère si ça passe minuit)
    let hTrav = d - a;
    if (hTrav < 0) hTrav += 24;

    // heures facturables = max(travail, 3h) + transport
    const hTransport = parseFloat(elTransport.value || "0");
    const hFact = Math.max(hTrav, MIN_TRAVAIL) + hTransport;

    // montants
    const sousTotal = hFact * taux;
    const mTps = sousTotal * TPS;
    const mTvq = sousTotal * TVQ;
    const totalTaxes = sousTotal + mTps + mTvq;

    const depot = parseFloat(elDepot.value || "0"); // taxes incluses
    const grandTotal = totalTaxes - depot;

    // affichage
    elResultat.style.display = "block";
    outHTravail.textContent = hTrav.toFixed(2) + " h";
    outHFact.textContent = hFact.toFixed(2) + " h";
    outSub.textContent = sousTotal.toFixed(2) + " $";
    outTps.textContent = mTps.toFixed(2) + " $";
    outTvq.textContent = mTvq.toFixed(2) + " $";
    outTotal.textContent = totalTaxes.toFixed(2) + " $";
    outDepot.textContent = "-" + depot.toFixed(2) + " $";
    outGrand.textContent = grandTotal.toFixed(2) + " $";
  }

  document.getElementById("btnCalc").addEventListener("click", calculer);
</script>
</body>
</html>